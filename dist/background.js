(()=>{"use strict";var e;!function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR"}(e||(e={}));const t=new class{constructor(t="FineDeal"){this.level=e.INFO,this.prefix=t,this.initializeLogLevel()}async initializeLogLevel(){try{if(chrome?.storage){const t=await chrome.storage.local.get(["logLevel"]);this.level=t.logLevel??e.INFO}}catch{}}setLevel(e){this.level=e;try{chrome?.storage&&chrome.storage.local.set({logLevel:e})}catch{}}debug(t,...a){this.level<=e.DEBUG&&console.log(`[${this.prefix}] ðŸ› ${t}`,...a)}info(t,...a){this.level<=e.INFO&&console.info(`[${this.prefix}] â„¹ï¸ ${t}`,...a)}warn(t,...a){this.level<=e.WARN&&console.warn(`[${this.prefix}] âš ï¸ ${t}`,...a)}error(t,a){this.level<=e.ERROR&&console.error(`[${this.prefix}] âŒ ${t}`,a)}group(e){console.group(`[${this.prefix}] ${e}`)}groupEnd(){console.groupEnd()}time(e){console.time(`[${this.prefix}] ${e}`)}timeEnd(e){console.timeEnd(`[${this.prefix}] ${e}`)}}("FineDeal"),a=new class{constructor(e=100,t=36e5){this.cache=new Map,this.maxSize=e,this.defaultTTL=t}get(e){const a=this.cache.get(e);return a?Date.now()-a.timestamp>a.ttl?(this.cache.delete(e),t.debug(`Cache expired: ${e}`),null):(this.cache.delete(e),this.cache.set(e,a),a.data):null}set(e,a,s){if(this.cache.size>=this.maxSize){const e=this.cache.keys().next().value;e&&(this.cache.delete(e),t.debug(`Cache evicted: ${e}`))}this.cache.set(e,{data:a,timestamp:Date.now(),ttl:s||this.defaultTTL})}has(e){return null!==this.get(e)}clear(){this.cache.clear(),t.info("Cache cleared")}size(){return this.cache.size}delete(e){return this.cache.delete(e)}};t.info("FineDeal Service Worker Started");const s=[];new Map,chrome.runtime.onInstalled.addListener(e=>{t.info("Extension installed:",e.reason),"install"===e.reason?chrome.storage.local.set({version:"1.0.0",installDate:Date.now(),stats:{comparisons:0,productsSaved:0}}):"update"===e.reason&&t.info("Updated to version 1.0.0")}),chrome.runtime.onMessage.addListener((e,a,i)=>{switch(t.debug("Background message:",e.type),e.type){case"START_COMPARISON":!async function(e,a){e&&(t.info("Starting comparison for tab:",e),function(e,a){const i={event:e,timestamp:Date.now(),data:a};s.push(i),t.debug("Analytics event:",i),s.length>1e3&&s.shift()}("comparison_started",{tabId:e,product:a?.title}),async function(e){const t=(await chrome.storage.local.get(["stats"])).stats||{};t[e]=(t[e]||0)+1,await chrome.storage.local.set({stats:t})}("comparisons"))}(a.tab?.id,e.data);break;case"SHOW_PRICE_DROP_NOTIFICATION":e.data&&chrome.notifications.create({type:"basic",iconUrl:e.data.iconUrl,title:e.data.title,message:e.data.message});break;default:t.warn("Unknown message type:",e.type)}return!0}),setInterval(()=>{a.clear(),t.debug("Cache cleared (periodic)")},36e5)})();
//# sourceMappingURL=background.js.map