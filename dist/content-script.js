(()=>{"use strict";const e={amazon:{name:"Amazon",badge:"amazon-badge",searchUrl:"https://www.amazon.in/s?k=",enabled:!0,priority:1,selectors:{productPage:{title:["#productTitle","h1.product-title","span#productTitle"],price:[".a-price-whole",".a-price .a-offscreen","span.a-price-whole",".a-price-range .a-price .a-offscreen"],image:["#landingImage",".a-dynamic-image","img#landingImage"],productId:["[data-asin]"],brand:["#bylineInfo",".a-size-base.po-break-word","a#bylineInfo"]},searchPage:{container:['div[data-component-type="s-search-result"]','div[data-asin]:not([data-asin=""])'],title:["h2 a span","h2 span.a-text-normal",".a-text-normal","h2.a-size-mini span"],price:[".a-price-whole","span.a-price-whole",".a-price .a-offscreen"],image:["img.s-image","img[data-image-latency]"],link:["h2 a","a.a-link-normal.s-no-outline"],productId:["[data-asin]"]}}},flipkart:{name:"Flipkart",badge:"flipkart-badge",searchUrl:"https://www.flipkart.com/search?q=",enabled:!0,priority:2,selectors:{productPage:{title:["span.VU-ZEz",".VU-ZEz",".B_NuCI","h1.B_NuCI","span.B_NuCI","h1",'[class*="title"]'],price:["div.Nx9bqj.CxhGGd",".Nx9bqj.CxhGGd","div.Nx9bqj",".Nx9bqj","._30jeq3","._16Jk6d",'[class*="price"]'],image:["._396cs4","._53J4C- img",".CXW8mj img","._396cs4 img",'img[class*="image"]'],productId:["[data-id]","[data-tkid]","[data-product-id]"],brand:["span._1Us2sh","._1Us2sh",".fMghEO span",".fMghEO"]},searchPage:{container:["div[data-id]","._1AtVbE","._13oc-S","div._1xHGtK",'[class*="product"]'],title:[".KzDlHZ","a.KzDlHZ",".s1Q9rs","a.s1Q9rs","._2WkVRV","a.IRpwTa",'[class*="title"]'],price:[".Nx9bqj","div.Nx9bqj","._30jeq3","div._30jeq3","._3tbKJL",'[class*="price"]'],image:["img._2r_T1I","img._396cs4",'img[class*="image"]',"img"],link:["a._1fQZEK","a.s1Q9rs","a._2rpwqI","a.IRpwTa",'a[href*="/p/"]',"a"]}}},myntra:{name:"Myntra",badge:"myntra-badge",searchUrl:"https://www.myntra.com/search?q=",enabled:!1,priority:3,selectors:{productPage:{title:[".pdp-title",".pdp-name","h1.pdp-name","h1.pdp-title",'[class*="pdp-title"]','[class*="pdp-name"]',"h1"],price:[".pdp-price",".pdp-price strong","span.pdp-price",".pdp-mrp",'[class*="pdp-price"]','[class*="pdp-mrp"]'],image:[".image-grid-image","img.image-grid-image",".pdp-image",'img[class*="image-grid"]',"img"],productId:["[data-productid]","[data-product-id]","[data-skuid]"],brand:[".pdp-title",".pdp-brand","h1.pdp-brand",'[class*="brand"]','[class*="pdp-brand"]']},searchPage:{container:[".product-base","li.product-base",".product-productMetaInfo",'[class*="product-base"]','li[class*="product"]'],title:[".product-brand",".product-product",".product-productMetaInfo h3","h3.product-brand","h4.product-product",'[class*="product-brand"]'],price:[".product-discountedPrice",".product-price","span.product-discountedPrice","div.product-price",'[class*="discounted"]','[class*="price"]'],image:["img.img-responsive",'img[class*="img-responsive"]',"picture img","img"],link:["a",'a[href*="/"]','[class*="product"] a'],productId:["[data-productid]","[data-product-id]","[data-skuid]"]}}},snapdeal:{name:"Snapdeal",badge:"snapdeal-badge",searchUrl:"https://www.snapdeal.com/search?keyword=",enabled:!0,priority:4,selectors:{productPage:{title:[".pdp-e-i-head","h1.pdp-e-i-head",".title-section h1",'[itemprop="name"]',"h1",'[class*="pdp-e-i-head"]'],price:[".pdp-final-price",".payBlkBig","span.payBlkBig",".pdp-e-i-price",'[class*="final-price"]','[class*="payBlk"]'],image:["#bx-img","img#bx-img",".mainImageWrapper img",".product-image img",'img[itemprop="image"]',"img"],productId:["[data-productid]","[data-product-id]",'[id*="product"]',"[data-pid]"],brand:['[itemprop="brand"]',".h2",".pdp-e-i-brand",'[class*="brand"]']},searchPage:{container:[".product-tuple-listing","div.product-tuple-listing",".col-xs-6",'[class*="product-tuple"]',".product"],title:[".product-title","p.product-title",".prodName","[title]",'[class*="title"]'],price:[".product-price","span.product-price",".lfloat",'[class*="price"]'],image:["img.product-image","source[srcset]","picture img","img"],link:['a[href*="/product/"]',"a.dp-widget-link",".product-tuple-listing a","a"],productId:["[data-productid]","[data-product-id]",'[id*="product"]',"[data-pid]"]}}},tatacliq:{name:"Tata CLiQ",badge:"tatacliq-badge",searchUrl:"https://www.tatacliq.com/search/?searchCategory=all&text=",enabled:!0,priority:5,selectors:{productPage:{title:["h1.ProductDetailsMainCard__productName",".ProductDetailsMainCard__productName",'[class*="productName"]',"h1",'[class*="title"]'],price:[".ProductDetailsMainCard__price","span.ProductDetailsMainCard__price",'[class*="price"]'],image:[".ProductDetailsMainCard__productImage",'img[class*="productImage"]',"picture img","img"],productId:["[data-productid]","[data-product-id]","[data-sku]"],brand:[".ProductDetailsMainCard__brandName",'[class*="brandName"]','[class*="brand"]']},searchPage:{container:[".ProductModule__base",'div[class*="ProductModule"]',".SearchModule__listingContainer > div",'[class*="product"]'],title:[".ProductModule__productTitle",".ProductDescription__title",'[class*="productTitle"]',"h2","h3"],price:[".ProductDescription__priceHolder",".ProductPrice__price",'[class*="price"]','span[class*="price"]'],image:['img[class*="ProductModule"]',"picture img","img"],link:['a[href*="/"]','a[class*="ProductModule"]',"a"],productId:["[data-productid]","[data-product-id]","[data-sku]"]}}},ajio:{name:"Ajio",badge:"ajio-badge",searchUrl:"https://www.ajio.com/search/?text=",enabled:!0,priority:6,selectors:{productPage:{title:[".prod-title","h1.prod-title",".pdp-title",'[class*="prod-title"]',"h1"],price:[".prod-sp","span.prod-sp",".prod-price",'[class*="prod-sp"]','[class*="price"]'],image:[".prod-image-container img",'img[class*="prod-image"]',"picture img","img"],productId:["[data-productid]","[data-product-code]","[data-sku]"],brand:[".prod-brand",'span[class*="brand"]','[class*="brand"]']},searchPage:{container:[".item",".rilrtl-products-list__item",'div[class*="item"]','[class*="product"]'],title:[".nameCls",".name",".product-name",'div[class*="name"]','[class*="title"]'],price:[".price","span.price",'[class*="discounted"]','[class*="price"]'],image:['img[class*="img"]',"picture img","img"],link:['a[href*="/p/"]','a[class*="product"]',"a"],productId:["[data-productid]","[data-product-code]","[data-sku]"]}}},nykaa:{name:"Nykaa",badge:"nykaa-badge",searchUrl:"https://www.nykaa.com/search/result/?q=",enabled:!0,priority:7,selectors:{productPage:{title:[".product-title",'h1[class*="product"]',"h1",'[class*="title"]'],price:[".product-price",'span[class*="price"]','[class*="offer-price"]','[class*="price"]'],image:[".product-image",'img[class*="product"]',"picture img","img"],productId:["[data-productid]","[data-product-id]","[data-id]"],brand:[".product-brand",'[class*="brand"]']},searchPage:{container:[".css-xrzmfa",".productWrapper",'div[class*="product"]',"article"],title:[".css-1jnyxt6","h2",'[class*="title"]','span[class*="title"]'],price:[".css-111z9ua",'span[class*="price"]','[class*="price"]'],image:['img[class*="css"]',"picture img","img"],link:['a[href*="/"]',"a"],productId:["[data-productid]","[data-product-id]","[data-id]"]}}},croma:{name:"Croma",badge:"croma-badge",searchUrl:"https://www.croma.com/searchB?q=",enabled:!0,priority:8,selectors:{productPage:{title:[".pd-title",'h1[class*="title"]',"h1",'[class*="product-title"]'],price:[".amount","span.amount",".new-price",'[class*="price"]','[class*="amount"]'],image:[".product-image",'img[class*="product"]',"picture img","img"],productId:["[data-product-id]","[data-productid]","[data-sku]"],brand:[".pd-brand",'[class*="brand"]']},searchPage:{container:[".product-item",".plp-card",'div[class*="product"]',"article"],title:[".product-title","h3",'[class*="title"]'],price:[".amount",".new-price",'span[class*="price"]','[class*="price"]'],image:['img[class*="product"]',"picture img","img"],link:['a[href*="/"]',"a"],productId:["[data-product-id]","[data-productid]","[data-sku]"]}}},vijaysales:{name:"Vijay Sales",badge:"vijaysales-badge",searchUrl:"https://www.vijaysales.com/search/",enabled:!0,priority:9,selectors:{productPage:{title:[".product-name",'h1[class*="product"]',"h1",'[class*="title"]'],price:[".price","span.price",".regular-price",'[class*="price"]'],image:[".product-image",'img[class*="product"]',"picture img","img"],productId:["[data-product-id]","[data-productid]","[data-sku]"],brand:[".product-brand",'[class*="brand"]']},searchPage:{container:[".product-item",".product-layout",".product-thumb",'div[class*="product"]',"article"],title:[".product-name","h4",'[class*="name"]','[class*="title"]'],price:[".price-new",".price",'span[class*="price"]','[class*="price"]'],image:['img[class*="img"]',"picture img","img"],link:['a[href*="/"]',"a"],productId:["[data-product-id]","[data-productid]","[data-sku]"]}}}};function t(t){for(const[r]of Object.entries(e))if(t.includes(r))return r;return null}function r(e){if(!e)return 0;const t=e.replace(/[^\d.]/g,""),r=parseFloat(t);return isNaN(r)?0:Math.round(r)}function a(e){const t=["Apple","Samsung","Xiaomi","OnePlus","Realme","Vivo","Oppo","Nokia","iPhone","iPad","MacBook","Galaxy","Pixel","Mi","Redmi","Nike","Adidas","Puma","Reebok","Levi","Zara","H&M","Mango","Lakme","Maybelline","L'Oreal","MAC","Revlon","Nykaa","Sony","LG","Philips","Panasonic","Whirlpool","Bosch","IFB","Dell","HP","Lenovo","Asus","Acer","MSI","Boat","JBL","Bose","Sennheiser","Canon","Nikon"],r=e.toLowerCase();if(/(iphone|ipad|macbook|airpods|apple)/i.test(r))return"Apple";for(const e of t)if(r.includes(e.toLowerCase()))return e;return e.trim().split(/\s+/)[0]||""}function i(e){const t=e.toLowerCase();return/(phone|mobile|smartphone|iphone|galaxy)/i.test(t)?"electronics-phone":/(laptop|notebook|macbook|computer|gaming laptop)/i.test(t)?"electronics-laptop":/(graphics card|gpu|geforce|radeon|video card)/i.test(t)?"electronics-gpu":/(tablet|ipad)/i.test(t)?"electronics-tablet":/(shirt|jeans|dress|trouser|shoe|sneaker|jacket|hoodie|kurta|saree)/i.test(t)?"fashion":/(lipstick|makeup|foundation|cream|lotion|serum|shampoo|perfume)/i.test(t)?"beauty":"general"}function c(e,t,r){const a={productNumber:"",modelNumber:"",partNumber:"",sku:"",asin:"",confidence:0,source:"title"};if(t&&/^[A-Z0-9]{10}$/.test(t))return a.asin=t,a.productNumber=t,a.confidence=100,a.source="attribute",a;if(r){const e=r.match(/\/dp\/([A-Z0-9]{10})|\/product\/([A-Z0-9]{10})|asin=([A-Z0-9]{10})/i);if(e)return a.asin=e[1]||e[2]||e[3],a.productNumber=a.asin,a.confidence=100,a.source="url",a}const i=[/\b([A-Z]{2}\d{2,3}[A-Z0-9]{2}\/[A-Z])\b/,/\b(SM-[A-Z]\d{3,4}[A-Z]?)\b/,/\b([A-Z]{2,4}[-]?\d{3,4}[-]?\d{0,2}[A-Z]?)\b/,/\b([A-Z]{2,4}[-]?\d{2}[-]?\d{4})\b/,/\b([A-Z]\d{2}[-]?\d{4})\b/,/\b(SKU[-:\s]?[A-Z0-9]{5,10})\b/i,/\b((?:PN|PART)[-:\s]?[A-Z0-9]{5,10})\b/i,/\b(\d{15})\b/,/\b([A-Z]{1,2}\d{4,6}[A-Z0-9]{0,2})\b/];for(const t of i){const r=e.match(t);if(r){const e=r[1];return e.includes("SKU")?(a.sku=e,a.productNumber=e,a.confidence=95):e.includes("PN")||e.includes("PART")?(a.partNumber=e,a.productNumber=e,a.confidence=95):e.match(/SM-[A-Z]\d{3,4}/)?(a.modelNumber=e,a.productNumber=e,a.confidence=90):e.match(/[A-Z]{2}\d{2,3}[A-Z0-9]{2}\/[A-Z]/)?(a.partNumber=e,a.productNumber=e,a.confidence=95):15===e.length&&/^\d+$/.test(e)?(a.modelNumber=e,a.productNumber=e,a.confidence=80):(a.modelNumber=e,a.productNumber=e,a.confidence=75),a.source="title",a}}const c=e.match(/[\(\[]([A-Z0-9\-\/]{6,15})[\)\]]/);if(c)return a.modelNumber=c[1],a.productNumber=c[1],a.confidence=70,a.source="title",a;const o=e.match(/\b([A-Z]\d{5,8})\b/);return o&&(a.modelNumber=o[1],a.productNumber=o[1],a.confidence=60,a.source="title"),a}function o(e){const t=e.textContent?.toLowerCase()||"",r=["out of stock","sold out","unavailable","not available","currently unavailable","temporarily unavailable","stock out","no stock","item is no longer available","discontinued","notify me when available","pre-order","coming soon"];for(const e of r)if(t.includes(e))return{status:"out-of-stock",confidence:95,indicator:e};const a=["only","left in stock","hurry","few items left","limited stock","low stock","almost gone","selling fast"];for(const e of a)if(t.includes(e))return{status:"limited-stock",confidence:70,indicator:e};const i=["in stock","available","add to cart","buy now","get it by","delivery by","ships from","free delivery"];for(const e of i)if(t.includes(e))return{status:"in-stock",confidence:90,indicator:e};return{status:"unknown",confidence:0,indicator:"no availability info"}}function s(e,t){if(!t)return!1;const r=o(e);if("out-of-stock"===r.status&&r.confidence>=80)return!1;if(e.querySelector('[data-testid="add-to-cart"], button[name="submit.add-to-cart"], .add-to-cart, .buy-now, [data-action="add-to-cart"]'))return!0;const a=t.textContent?.trim()||"";return!(!a||0===a.length||!/[â‚¹$â‚¬Â£]\s*\d+|rupees|rs\.?\s*\d+/i.test(a)&&"out-of-stock"===r.status)}var n;!function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR"}(n||(n={}));const d=new class{constructor(e="FineDeal"){this.level=n.INFO,this.prefix=e,this.initializeLogLevel()}async initializeLogLevel(){try{if(chrome?.storage){const e=await chrome.storage.local.get(["logLevel"]);this.level=e.logLevel??n.INFO}}catch{}}setLevel(e){this.level=e;try{chrome?.storage&&chrome.storage.local.set({logLevel:e})}catch{}}debug(e,...t){this.level<=n.DEBUG&&console.log(`[${this.prefix}] ðŸ› ${e}`,...t)}info(e,...t){this.level<=n.INFO&&console.info(`[${this.prefix}] â„¹ï¸ ${e}`,...t)}warn(e,...t){this.level<=n.WARN&&console.warn(`[${this.prefix}] âš ï¸ ${e}`,...t)}error(e,t){this.level<=n.ERROR&&console.error(`[${this.prefix}] âŒ ${e}`,t)}group(e){console.group(`[${this.prefix}] ${e}`)}groupEnd(){console.groupEnd()}time(e){console.time(`[${this.prefix}] ${e}`)}timeEnd(e){console.timeEnd(`[${this.prefix}] ${e}`)}}("FineDeal");async function p(e,t=6e3){d.debug("Waiting for page to be ready...");const r=e.map(e=>function(e,t=5e3){return new Promise(r=>{const a=document.querySelector(e);if(a)return d.debug(`Element ${e} already present`),r(a);const i=new MutationObserver(()=>{const t=document.querySelector(e);t&&(i.disconnect(),d.debug(`Element ${e} appeared after observation`),r(t))});i.observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1}),setTimeout(()=>{i.disconnect(),d.warn(`Timeout waiting for ${e}`),r(null)},t)})}(e,t));return await Promise.race(r)?(d.info("Page ready - key elements found"),!0):(d.warn("Page ready timeout - proceeding anyway"),!1)}function l(e){for(const t of e){const e=document.querySelector(t);if(e?.textContent)return e.textContent.trim()}return""}function u(e,t){for(const r of e){const e=document.querySelector(r);if(e)return e.getAttribute(t)||""}return""}function m(e,t,r){for(const a of t){const t=e.querySelector(a);if(t)return t.getAttribute(r)||""}return e.getAttribute(r)||""}d.info("FineDeal Content Script Loaded"),chrome.runtime.onMessage.addListener((n,g,b)=>(d.debug("Message received:",n.type),"GET_PRODUCT_INFO"===n.type?(function(o){try{const s=t(window.location.hostname);if(!s)return void o({site:"unknown",title:"Please visit a supported e-commerce site",price:"",numericPrice:0,url:"",image:"",productId:"",brand:"",category:""});const n=function(t){const o=e[t],s=window.location.href,n=l(o.selectors.productPage.title)||"Product not found",d=l(o.selectors.productPage.price)||"",p=function(e){for(const t of e){const e=document.querySelector(t);if(e)return e.src||e.getAttribute("data-src")||""}return""}(o.selectors.productPage.image)||"",m=u(o.selectors.productPage.productId,"data-asin")||u(o.selectors.productPage.productId,"data-id")||"",g=o.selectors.productPage.brand?l(o.selectors.productPage.brand):"",b=c(n,m,s);let h="unknown";const f=document.body.textContent?.toLowerCase()||"";return f.includes("out of stock")||f.includes("currently unavailable")?h="out-of-stock":f.includes("in stock")||f.includes("add to cart")?h="in-stock":f.includes("only")&&f.includes("left")&&(h="limited-stock"),{site:t,title:n,price:d,numericPrice:r(d),url:s,image:p,productId:m,brand:g||a(n),category:i(n),productNumber:b.productNumber||void 0,sku:b.sku||void 0,availability:h}}(s);if(d.info("Product extracted:",n.title),("flipkart"===s||"amazon"===s)&&n.productId&&n.numericPrice>0)try{const e=`last_price_${s}_${n.productId}`,t=localStorage.getItem(e),r=t?parseFloat(t):null,a=`notified_price_${s}_${n.productId}`,i=localStorage.getItem(a),c=i&&parseFloat(i)===n.numericPrice,o=`notify_enabled_${s}_${n.productId}`;"true"===localStorage.getItem(o)&&null!==r&&n.numericPrice<r&&!c&&(chrome.runtime.sendMessage({type:"SHOW_PRICE_DROP_NOTIFICATION",data:{title:"Price Drop Alert!",message:`${n.title.substring(0,60)}\nPrice dropped from â‚¹${r} to â‚¹${n.numericPrice}`,iconUrl:n.image||chrome.runtime.getURL("assets/icon-128.png")}}),localStorage.setItem(a,String(n.numericPrice))),localStorage.setItem(e,String(n.numericPrice))}catch(e){d.warn("Price drop notification error:",e)}o(n)}catch(e){d.error("Error extracting product info:",e),o({site:"error",title:"Error extracting product information",price:"",numericPrice:0,url:"",image:"",productId:"",brand:"",category:""})}}(b),!0):"GET_SEARCH_RESULTS"===n.type?(function(n){try{const p=window.location.hostname,l=t(p);if(!l)return void n({site:p,products:[]});const u=function(t){const n=e[t],p=[];let l=null;for(const e of n.selectors.searchPage.container)if(l=document.querySelectorAll(e),l&&l.length>0){d.debug(`Found ${l.length} containers with selector: ${e}`);break}if(!l||0===l.length)return d.warn(`No product containers found on page for ${t}`),p;d.info(`Scraping ${l.length} products from ${t}`);const u=Math.min(20,l.length);for(let e=0;e<u;e++){const u=l[e];try{const l=u.querySelector(n.selectors.searchPage.title.join(",")),g=u.querySelector(n.selectors.searchPage.price.join(",")),b=u.querySelector(n.selectors.searchPage.image.join(",")),h=u.querySelector(n.selectors.searchPage.link.join(","));if(!l||!g){d.debug(`Skipping container ${e}: missing title or price`);continue}if(!s(u,g)){d.debug(`Skipping container ${e}: product not available`);continue}const f=l.textContent?.trim()||"",y=g.textContent?.trim()||"";if(!f||!y){d.debug(`Skipping container ${e}: empty title or price`);continue}const k=r(y);if(k<10){d.debug(`Skipping container ${e}: invalid price ${k} from "${y}"`);continue}const P=b?.src||b?.getAttribute("data-src")||b?.getAttribute("data-lazy-src")||"",w=h?.href||"";if(!w){d.debug(`Skipping container ${e}: no URL found`);continue}const v=n.selectors.searchPage.productId&&(m(u,n.selectors.searchPage.productId,"data-asin")||m(u,n.selectors.searchPage.productId,"data-id"))||"",_=c(f,v,w),I=o(u);p.push({site:t,title:f,price:y,numericPrice:r(y),url:w.startsWith("http")?w:`https://${window.location.hostname}${w}`,image:P,productId:v,brand:a(f),category:i(f),productNumber:_.productNumber||void 0,sku:_.sku||void 0,availability:I.status})}catch(t){d.debug(`Error scraping product at index ${e}:`,t)}}return p}(l);d.info(`Scraped ${u.length} products from ${l}`),n({site:l,products:u})}catch(e){d.error("Error scraping search results:",e),n({site:"error",products:[]})}}(b),!0):"WAIT_FOR_PAGE_READY"===n.type&&(async function(r){try{const a=t(window.location.hostname);if(!a)return void r({ready:!1});const i=e[a],c=[...i.selectors.searchPage.container,...i.selectors.searchPage.price];r({ready:await p(c)})}catch(e){d.error("Error waiting for page ready:",e),r({ready:!1})}}(b),!0)))})();
//# sourceMappingURL=content-script.js.map